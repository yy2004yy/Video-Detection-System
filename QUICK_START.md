# å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ¯ ä¸»ç¨‹åºå…¥å£è¯´æ˜

é¡¹ç›®æœ‰ä¸‰ä¸ªä¸»ç¨‹åºï¼Œæ¯ä¸ªéƒ½æœ‰æ˜ç¡®çš„å…¥å£ç‚¹ï¼š

### 1. train.py - è®­ç»ƒç¨‹åº

**å…¥å£ç‚¹ï¼š** æ–‡ä»¶æœ«å°¾çš„ `if __name__ == "__main__": main()`

**ä½ç½®ï¼š** ```219:219:train.py
if __name__ == "__main__":
    main()
```

**å¯åŠ¨æ–¹å¼ï¼š**
```bash
# åŸºç¡€è®­ç»ƒ
python train.py --config configs/clip_baseline.yaml

# æ¢å¤è®­ç»ƒ
python train.py --config configs/clip_baseline.yaml --resume checkpoints/checkpoint_epoch_10.pth
```

**æ‰§è¡Œé¡ºåºï¼š**
1. è§£æå‘½ä»¤è¡Œå‚æ•°
2. åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆYAMLï¼‰
3. åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
4. è®¾ç½®éšæœºç§å­å’Œè®¾å¤‡
5. åˆ›å»ºæ¨¡å‹
6. åˆ›å»ºæ•°æ®åŠ è½½å™¨
7. è®­ç»ƒå¾ªç¯ï¼ˆepochå¾ªç¯ï¼‰
8. ä¿å­˜æ£€æŸ¥ç‚¹

---

### 2. test.py - æµ‹è¯•ç¨‹åº

**å…¥å£ç‚¹ï¼š** æ–‡ä»¶æœ«å°¾çš„ `if __name__ == "__main__": main()`

**ä½ç½®ï¼š** ```160:162:test.py
if __name__ == "__main__":
    main()
```

**å¯åŠ¨æ–¹å¼ï¼š**
```bash
python test.py \
    --config configs/clip_baseline.yaml \
    --checkpoint checkpoints/best_model.pth \
    --output test_results.txt
```

**æ‰§è¡Œé¡ºåºï¼š**
1. è§£æå‘½ä»¤è¡Œå‚æ•°
2. åŠ è½½é…ç½®å’Œæ¨¡å‹æƒé‡
3. åˆ›å»ºæµ‹è¯•æ•°æ®é›†
4. åœ¨æµ‹è¯•é›†ä¸Šæ¨ç†
5. è®¡ç®—è¯„ä¼°æŒ‡æ ‡
6. ä¿å­˜ç»“æœæ–‡ä»¶

---

### 3. inference.py - æ¨ç†ç¨‹åº

**å…¥å£ç‚¹ï¼š** æ–‡ä»¶æœ«å°¾çš„ `if __name__ == "__main__": main()`

**ä½ç½®ï¼š** ```150:152:inference.py
if __name__ == "__main__":
    main()
```

**å¯åŠ¨æ–¹å¼ï¼š**
```bash
python inference.py \
    --config configs/clip_baseline.yaml \
    --checkpoint checkpoints/best_model.pth \
    --video path/to/video.mp4 \
    --num_frames 8
```

**æ‰§è¡Œé¡ºåºï¼š**
1. æ£€æŸ¥è§†é¢‘æ–‡ä»¶
2. åŠ è½½é…ç½®å’Œæ¨¡å‹
3. æå–è§†é¢‘å¸§
4. æ¨¡å‹æ¨ç†
5. è¾“å‡ºç»“æœ

---

## ğŸ“‚ é¡¹ç›®æ–‡ä»¶ç»“æ„è¯´æ˜

```
DeepFake_Project/
â”‚
â”œâ”€â”€ ğŸ“‚ configs/              # é…ç½®ä¸­å¿ƒ
â”‚   â”œâ”€â”€ clip_baseline.yaml   # CLIPåŸºå‡†å®éªŒé…ç½®
â”‚   â””â”€â”€ imagebind_fusion.yaml # ImageBindèåˆå®éªŒé…ç½®
â”‚
â”œâ”€â”€ ğŸ“‚ data/                  # æ•°æ®æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py          # å¯¼å‡ºVideoDatasetç­‰
â”‚   â”œâ”€â”€ dataset.py            # PyTorchæ•°æ®é›†ç±»
â”‚   â””â”€â”€ preprocess.py        # è§†é¢‘é¢„å¤„ç†å‡½æ•°
â”‚
â”œâ”€â”€ ğŸ“‚ models/                # æ¨¡å‹æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py          # å¯¼å‡ºDeepFakeDetector
â”‚   â”œâ”€â”€ backbones/           # éª¨å¹²ç½‘ç»œ
â”‚   â”‚   â”œâ”€â”€ clip_encoder.py  # CLIPç‰¹å¾æå–å™¨
â”‚   â”‚   â””â”€â”€ imagebind_encoder.py # ImageBindç‰¹å¾æå–å™¨
â”‚   â””â”€â”€ detectors.py         # æ£€æµ‹å™¨ï¼ˆbackbone + åˆ†ç±»å¤´ï¼‰
â”‚
â”œâ”€â”€ ğŸ“‚ utils/                 # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py          # å¯¼å‡ºæ‰€æœ‰å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ logger.py            # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ metrics.py           # è¯„ä¼°æŒ‡æ ‡ï¼ˆå‡†ç¡®ç‡ã€F1ã€AUCï¼‰
â”‚   â””â”€â”€ tools.py             # å·¥å…·å‡½æ•°ï¼ˆéšæœºç§å­ã€æ¨¡å‹ä¿å­˜ç­‰ï¼‰
â”‚
â”œâ”€â”€ ğŸ“‚ checkpoints/           # æ¨¡å‹æƒé‡ä¿å­˜ç›®å½•
â”œâ”€â”€ ğŸ“‚ logs/                  # æ—¥å¿—æ–‡ä»¶ä¿å­˜ç›®å½•
â”‚
â”œâ”€â”€ train.py                  # ğŸš€ è®­ç»ƒå…¥å£
â”œâ”€â”€ test.py                   # ğŸš€ æµ‹è¯•å…¥å£
â”œâ”€â”€ inference.py              # ğŸš€ æ¨ç†å…¥å£
â”œâ”€â”€ requirements.txt         # ä¾èµ–åˆ—è¡¨
â””â”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
```

---

## ğŸ” ä»£ç æ‰§è¡Œæµç¨‹è¯¦è§£

### è®­ç»ƒæµç¨‹ (train.py)

```
å‘½ä»¤è¡Œå¯åŠ¨
  â†“
main() å‡½æ•°
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å‚æ•°è§£æ                          â”‚
â”‚    --config: é…ç½®æ–‡ä»¶è·¯å¾„            â”‚
â”‚    --resume: æ¢å¤è®­ç»ƒçš„æ£€æŸ¥ç‚¹        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. é…ç½®åŠ è½½                          â”‚
â”‚    load_config() â†’ è¯»å–YAMLæ–‡ä»¶      â”‚
â”‚    è·å–æ¨¡å‹ã€è®­ç»ƒã€è®¾å¤‡ç­‰å‚æ•°        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ç¯å¢ƒåˆå§‹åŒ–                        â”‚
â”‚    setup_logger() â†’ æ—¥å¿—ç³»ç»Ÿ         â”‚
â”‚    set_seed() â†’ éšæœºç§å­             â”‚
â”‚    setup_device() â†’ GPUè®¾å¤‡          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ¨¡å‹åˆ›å»º                          â”‚
â”‚    DeepFakeDetector()                â”‚
â”‚      â”œâ”€â”€ åˆ›å»ºbackbone (CLIP/ImageBind)â”‚
â”‚      â””â”€â”€ åˆ›å»ºåˆ†ç±»å¤´                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ•°æ®å‡†å¤‡                          â”‚
â”‚    VideoDataset() â†’ æ•°æ®é›†           â”‚
â”‚    DataLoader() â†’ æ•°æ®åŠ è½½å™¨         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. è®­ç»ƒå¾ªç¯                          â”‚
â”‚    for epoch in range(num_epochs):   â”‚
â”‚      â”œâ”€â”€ train_epoch() â†’ è®­ç»ƒä¸€ä¸ªepochâ”‚
â”‚      â”œâ”€â”€ validate() â†’ éªŒè¯           â”‚
â”‚      â””â”€â”€ save_checkpoint() â†’ ä¿å­˜æ¨¡å‹â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµ‹è¯•æµç¨‹ (test.py)

```
å‘½ä»¤è¡Œå¯åŠ¨
  â†“
main() å‡½æ•°
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åŠ è½½é…ç½®å’Œæ¨¡å‹                    â”‚
â”‚    load_config() â†’ é…ç½®æ–‡ä»¶          â”‚
â”‚    load_checkpoint() â†’ æ¨¡å‹æƒé‡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åˆ›å»ºæµ‹è¯•æ•°æ®é›†                    â”‚
â”‚    VideoDataset() â†’ æµ‹è¯•é›†           â”‚
â”‚    DataLoader() â†’ æ•°æ®åŠ è½½å™¨         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ¨¡å‹æ¨ç†                          â”‚
â”‚    test() å‡½æ•°                       â”‚
â”‚      â”œâ”€â”€ éå†æµ‹è¯•é›†                  â”‚
â”‚      â”œâ”€â”€ æ¨¡å‹å‰å‘ä¼ æ’­                â”‚
â”‚      â””â”€â”€ æ”¶é›†é¢„æµ‹ç»“æœ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. è®¡ç®—æŒ‡æ ‡                          â”‚
â”‚    calculate_metrics()               â”‚
â”‚      â”œâ”€â”€ å‡†ç¡®ç‡ (Accuracy)           â”‚
â”‚      â”œâ”€â”€ F1-score                    â”‚
â”‚      â”œâ”€â”€ AUC                         â”‚
â”‚      â””â”€â”€ æ··æ·†çŸ©é˜µ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ä¿å­˜ç»“æœ                          â”‚
â”‚    å†™å…¥ test_results.txt             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨ç†æµç¨‹ (inference.py)

```
å‘½ä»¤è¡Œå¯åŠ¨
  â†“
main() å‡½æ•°
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ£€æŸ¥è¾“å…¥                          â”‚
â”‚    éªŒè¯è§†é¢‘æ–‡ä»¶æ˜¯å¦å­˜åœ¨              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åŠ è½½æ¨¡å‹                          â”‚
â”‚    load_config() â†’ é…ç½®              â”‚
â”‚    load_checkpoint() â†’ æƒé‡          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è§†é¢‘å¤„ç†                          â”‚
â”‚    inference_single_video()          â”‚
â”‚      â”œâ”€â”€ extract_frames_from_video() â”‚
â”‚      â”œâ”€â”€ å›¾åƒé¢„å¤„ç†                  â”‚
â”‚      â””â”€â”€ æ¨¡å‹æ¨ç†                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. è¾“å‡ºç»“æœ                          â”‚
â”‚    æ‰“å°é¢„æµ‹ç±»åˆ«å’Œç½®ä¿¡åº¦              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ è®¾è®¡æ€è·¯æ€»ç»“

### 1. **åˆ†å±‚æ¶æ„**
- **ä¸»ç¨‹åºå±‚**ï¼šç”¨æˆ·äº¤äº’å…¥å£
- **é…ç½®å±‚**ï¼šå‚æ•°ç®¡ç†
- **æ¨¡å‹å±‚**ï¼šç®—æ³•å®ç°
- **æ•°æ®å±‚**ï¼šæ•°æ®å¤„ç†
- **å·¥å…·å±‚**ï¼šé€šç”¨åŠŸèƒ½

### 2. **é…ç½®é©±åŠ¨**
- æ‰€æœ‰å‚æ•°é€šè¿‡YAMLæ–‡ä»¶ç®¡ç†
- æ— éœ€ä¿®æ”¹ä»£ç å³å¯è°ƒæ•´å®éªŒè®¾ç½®
- ä¾¿äºç‰ˆæœ¬æ§åˆ¶å’Œå®éªŒå¯¹æ¯”

### 3. **æ¨¡å—åŒ–è®¾è®¡**
- æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€
- æ¨¡å—é—´ä½è€¦åˆ
- æ˜“äºæ‰©å±•å’Œç»´æŠ¤

### 4. **å¯å¤ç°æ€§**
- ç»Ÿä¸€çš„éšæœºç§å­è®¾ç½®
- å®Œæ•´çš„æ—¥å¿—è®°å½•
- æ¨¡å‹æ£€æŸ¥ç‚¹ä¿å­˜

### 5. **æ˜“ç”¨æ€§**
- æ¸…æ™°çš„å‘½ä»¤è¡Œæ¥å£
- è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- å‹å¥½çš„é”™è¯¯æç¤º

---

## ğŸš¦ ä¸‹ä¸€æ­¥æ“ä½œ

1. **é…ç½®æ•°æ®é›†**ï¼šä¿®æ”¹ `train.py` å’Œ `test.py` ä¸­çš„æ•°æ®è·¯å¾„
2. **å®‰è£…ä¾èµ–**ï¼š`pip install -r requirements.txt`
3. **å¼€å§‹è®­ç»ƒ**ï¼š`python train.py --config configs/clip_baseline.yaml`
4. **æŸ¥çœ‹æ—¥å¿—**ï¼š`logs/` ç›®å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶
5. **æµ‹è¯•æ¨¡å‹**ï¼šè®­ç»ƒå®Œæˆåè¿è¡Œ `test.py`
6. **å•è§†é¢‘æ¨ç†**ï¼šä½¿ç”¨ `inference.py` è¿›è¡Œæ¼”ç¤º

---

## ğŸ’¡ å…³é”®ä»£ç ä½ç½®

- **æ¨¡å‹å®šä¹‰**ï¼š`models/detectors.py`
- **æ•°æ®åŠ è½½**ï¼š`data/dataset.py`
- **è®­ç»ƒé€»è¾‘**ï¼š`train.py` çš„ `train_epoch()` å‡½æ•°
- **è¯„ä¼°æŒ‡æ ‡**ï¼š`utils/metrics.py`
- **é…ç½®ç®¡ç†**ï¼š`utils/tools.py` çš„ `load_config()` å‡½æ•°

